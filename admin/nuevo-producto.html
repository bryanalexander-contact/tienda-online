<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nuevo Producto - Admin</title>
<link rel="stylesheet" href="../css/admin/nuevo-producto.css">
</head>
<body>
<div class="admin-container">
  <aside class="sidebar">
    <h2>Panel Productos</h2>
    <ul>
      <li><a href="mostrar-productos.html">Mostrar Productos</a></li>
      <li><a href="nuevo-producto.html" class="active">Nuevo Producto</a></li>
    </ul>
  </aside>

  <main class="admin-main">
    <h1>Agregar Nuevo Producto</h1>
    <form id="form-nuevo-producto">
      <label for="codigo">Código Producto</label>
      <input type="text" id="codigo" name="codigo" minlength="3" required>

      <label for="nombre">Nombre</label>
      <input type="text" id="nombre" name="nombre" maxlength="100" required>

      <label for="descripcion">Descripción</label>
      <textarea id="descripcion" name="descripcion" maxlength="500"></textarea>

      <label for="precio">Precio</label>
      <input type="number" id="precio" name="precio" min="0" step="0.01" required>

      <label for="stock">Stock</label>
      <input type="number" id="stock" name="stock" min="0" step="1" required>

      <label for="stockCritico">Stock Crítico</label>
      <input type="number" id="stockCritico" name="stockCritico" min="0" step="1">

      <label for="categoria">Categoría</label>
      <select id="categoria" name="categoria" required>
        <option value="" disabled selected>Seleccione categoría</option>
        <option value="Electrónica">Electrónica</option>
        <option value="Ropa">Ropa</option>
        <option value="Hogar">Hogar</option>
      </select>

      <label for="imagenArchivo">Imagen (archivo)</label>
      <input type="file" id="imagenArchivo" accept="image/*">

      <label for="imagenUrl">O ingresa URL de imagen</label>
      <input type="text" id="imagenUrl" placeholder="https://...">

      <button type="submit">Agregar Producto</button>
    </form>
  </main>
</div>

<script src="../scripts/productos.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('form-nuevo-producto');
  form.addEventListener('submit', e => {
    e.preventDefault();

    const archivo = document.getElementById('imagenArchivo').files[0];
    const url = document.getElementById('imagenUrl').value.trim();

    function agregarProductoConImagen(imagenFinal) {
      const producto = {
        codigo: form.codigo.value.trim(),
        nombre: form.nombre.value.trim(),
        descripcion: form.descripcion.value.trim(),
        precio: parseFloat(form.precio.value),
        stock: parseInt(form.stock.value),
        stockCritico: parseInt(form.stockCritico.value) || null,
        categoria: form.categoria.value,
        imagen: imagenFinal
      };
      agregarProducto(producto);
      alert('Producto agregado correctamente!');
      form.reset();
    }

    if (archivo) {
      const reader = new FileReader();
      reader.onload = () => agregarProductoConImagen(reader.result);
      reader.readAsDataURL(archivo);
    } else {
      agregarProductoConImagen(url || '');
    }
  });
});
</script>
</body>
</html>
